{namespace vhs = FluidTYPO3\Vhs\ViewHelpers}
{namespace tv = Pmwebdesign\Staffm\ViewHelpers}

<f:form action="list" arguments="{mitarbeiter:mitarbeiter, key:key, berechtigung:berechtigung, cache: '{cache}'}" additionalAttributes="{role: 'form'}">                                  
    <tv:widget.atoZNav objects="{qualifikations}" as="filteredQualifikations" property="bezeichnung" search="{search}" maid="{maid}"> 
        <div class="input-group">
            <div class="input-group-prepend">
                <f:security.ifHasRole role="PA">                                                           
                    <f:link.action class="btn btn-default" title="Neue Qualifikation anlegen" action="new"><f:translate id="staffm.qualifikation.new" /></f:link.action>                               
                </f:security.ifHasRole>
                <f:link.action title="Die Liste in Excel ausgeben" id="excelExport" class="btn btn-default" action="export" arguments="{searching:'{search}'}" >
                    <f:image class="tx_staffm icon" src="typo3conf/ext/staffm/Resources/Public/Icons/Excel.png" />
                    Excel Export
                </f:link.action>
            </div>
            <f:form.textfield class="form-control" placeholder="Suchwort..." title="Volltextsuche fÃ¼r Bezeichnung, oder einen Teil der Beschreibung einer Qualifikation" name="search" value="{search}" />                                                            
            <div class="input-group-append">   
                <button type="submit" class="btn btn-default"><f:translate id="staffm.search" /></button>
            </div>                            
        </div>
        <tv:widget.sort objects="{filteredQualifikations}" as="sortedQualifikations" property="bezeichnung">                   
            <table class="tx_staffm" >
                <tr>
                    <th><f:translate key="tx_staffm_domain_model_qualifikation.bezeichnung" /></th>  
                <th><f:translate key="tx_staffm_domain_model_qualifikation.beschreibung" /></th>
                <th class="staffmmobilehidden"><f:translate id="staffm.text.zugeordnete" /> <f:translate key="tx_staffm_domain_model_mitarbeiter" /></th>                                
                </tr>
                <f:for each="{sortedQualifikations}" as="qualifikation">
                    <tr>
                        <td><div id="q{qualifikation.uid}" class="anchor"></div><div class="tx_staffm tds250"><f:link.action title="{qualifikation.bezeichnung}" action="show" arguments="{qualifikation : qualifikation, search:search}">{qualifikation.bezeichnung}</f:link.action></div></td>
                        <td><div class="tx_staffm tds400"><f:link.action title="{qualifikation.beschreibung}" action="show" arguments="{qualifikation : qualifikation, search:search}">{qualifikation.beschreibung}</f:link.action></div></td>                                                                                   
                        <td class="staffmmobilehidden">
                            <tv:widget.qualiStatus objects="{qualifikation.employeequalifications}" as="sortedEmployeequalifications" property="{f:if(condition: '{search} != \'\'', then: 'check')}">    
                                <f:for each="{sortedEmployeequalifications -> vhs:iterator.sort(sortBy: 'status')}" as="m" iteration="iteration" reverse="TRUE">                      
                                    <f:if condition="{iteration.isFirst}">
                                        <f:then>
                                            <p class="marksq" title="{m.employee.telephone}"><f:link.action action="show" arguments="{qualifikation : qualifikation, search:search}"><span>{m.employee.lastName} {m.employee.firstName}{f:if(condition:'{m.showstatus} == TRUE', then:' ({m.status})')}</span></f:link.action>
                                            <f:if condition="{countmit} > 1">
                                                <a class="btn btn-secondary btn-sm" style="float:right" href="javascript:void(0)" id="q{qualifikation.uid}" onClick="getID(this);return false;"><span name="q{qualifikation.uid}glyphiconchange" id="q{qualifikation.uid}" class="glyphicon glyphicon-triangle-bottom" aria-hidden="true"></span>
                                                    <f:if condition="{countmit} < 10">
                                                        0
                                                    </f:if>
                                                    {countmit}</a>
                                            </f:if>
                                            </p>
                                        </f:then>
                                        <f:else>
                                            <p class="marksq q{qualifikation.uid}hidden" style="display:none" title="{m.employee.telephone}"><f:link.action action="show" arguments="{qualifikation : qualifikation, search:search}">{m.employee.lastName} {m.employee.firstName}{f:if(condition:'{m.showstatus} == TRUE', then:' ({m.status})')}</f:link.action></p>                                            
                                        </f:else>
                                    </f:if>
                                </f:for>
                            </tv:widget.qualiStatus>
                        </td>                                         
                        <f:security.ifHasRole role="PA">
                            <td class="staffmmobilehidden nobackground">
                                <div class="btn-group">
                                    <f:link.action class="btn btn-secondary btn-sm" action="edit" arguments="{qualifikation : qualifikation}"><f:translate id="staffm.edit" /></f:link.action>
                                    <f:link.action class="btn btn-danger btn-sm" action="delete" arguments="{qualifikation : qualifikation}"><f:translate id="staffm.delete" /></f:link.action>
                                </div>
                            </td>
                        </f:security.ifHasRole>
                    </tr>
                </f:for>
            </table>
        </tv:widget.sort>
    </tv:widget.atoZNav>
</f:form>
